<project name="cobertura">

    <import file="properties.xml"/>

    <!-- used to test cobertura instruements -->
    <target name="cobertura:instrument">
        <taskdef classpathref="classpath.cobertura" resource="tasks.properties"/>
        <delete file="${target.reports.cobertura.dir}/cobertura.ser" />
        <copy todir="${target.test.cobertura_instrumented.dir}">
            <fileset dir="${resources.main.dir}"/>
        </copy>
        <cobertura-instrument todir="${target.test.cobertura_instrumented.dir}" datafile="${target.reports.cobertura.dir}/cobertura.ser">
            <fileset dir="${target.main.dir}">
                <include name="**/*.class" />
            </fileset>
        </cobertura-instrument>
    </target>

    <!-- used to test cobertura report generation-->
    <target name="cobertura:report" depends="db:start, db:update">
        <taskdef classpathref="classpath.cobertura" resource="tasks.properties"/>
        <cobertura-report-gen />
        <cobertura-report format="xml" destdir="${target.reports.cobertura.dir}" datafile="${target.reports.cobertura.dir}/cobertura.ser">
            <fileset dir="${src.main.dir}">
                <include name="**/*.java" />
            </fileset>
        </cobertura-report>
    </target>

    <target name="cobertura:all" depends="cobertura:instrument, cobertura:report" />

</project>
