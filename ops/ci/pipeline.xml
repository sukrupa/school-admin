<pipeline name="all">
  <trackingtool link="https://minglehosting.thoughtworks.com/sip/projects/sukrupa/cards/${ID}" regex="##(\d+)" />
  <materials>
    <git url="git@github.com:ThoughtWorksDonateNow2/sukrupa.git" />
  </materials>
  <stage name="build">
    <jobs>
      <job name="build">
        <tasks>
          <exec command="./build" />
        </tasks>
        <artifacts>
          <test src="target/reports" />
          <artifact src="target/school-admin.zip" dest="deploy" />
        </artifacts>
      </job>
    </jobs>
  </stage>
  <stage name="sonar">
    <jobs>
      <job name="sonar">
        <tasks>
          <exec command="mvn">
            <arg value="--file" />
            <arg value="ops/sonar/pom.xml" />
            <arg value="sonar:sonar" />
          </exec>
        </tasks>
      </job>
    </jobs>
  </stage>
  <stage name="deploy-staging">
    <jobs>
      <job name="deploy-staging">
        <tasks>
          <fetchartifact stage="build" job="build" srcfile="deploy/school-admin.zip" dest="target" />
          <exec command="./build" args="deploy:staging" />
        </tasks>
      </job>
    </jobs>
  </stage>
</pipeline>

