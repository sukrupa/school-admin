<pipeline name="all">
  <materials>
    <git url="git@github.com:ThoughtWorksDonateNow2/sukrupa.git" />
  </materials>
  <stage name="build">
    <jobs>
      <job name="build">
        <tasks>
          <exec command="./build" />
        </tasks>
        <artifacts>
          <test src="target/reports" />
          <artifact src="target/school-admin-${cruise_pipeline_counter}.zip" />
        </artifacts>
      </job>
    </jobs>
  </stage>
  <stage name="sonar">
    <jobs>
      <job name="sonar">
        <tasks>
          <exec command="mvn">
            <arg value="--file" />
            <arg value="ops/sonar/pom.xml" />
            <arg value="sonar:sonar" />
          </exec>
        </tasks>
      </job>
    </jobs>
  </stage>
  <stage name="deploy-staging">
    <jobs>
      <job name="deploy-staging">
        <tasks>
          <exec command="./build" args="deploy:staging" />
        </tasks>
      </job>
    </jobs>
  </stage>
</pipeline>
